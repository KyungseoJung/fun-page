<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</title>
  <style>
    :root{
      --bg:#070a14;
      --card: rgba(18,26,43,0.70);
      --stroke: rgba(255,255,255,0.10);
      --text:#eef3ff;
      --muted:#a9b6d6;
      --shadow: 0 16px 60px rgba(0,0,0,0.45);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(900px 550px at 50% 22%, #1b2a55, var(--bg));
      color:var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif;
      overflow:hidden;
    }

    /* ê³µí†µ ì¹´ë“œ */
    .card{
      width:min(640px, 92vw);
      min-height: 360px;
      padding:40px 28px;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: 20px;
      box-shadow: var(--shadow);
      text-align:center;
      backdrop-filter: blur(10px);
      position: relative;
      overflow:hidden;
    }

    h1{
      margin:0 0 10px;
      font-size: 30px;
      letter-spacing: -0.6px;
    }
    p{
      margin:0 0 26px;
      color: var(--muted);
      font-size: 14px;
    }

    /* ë²„íŠ¼ ì˜ì—­: ë²„íŠ¼ì´ í™”ë©´ ë°–ìœ¼ë¡œ íŠ€ì§€ ì•Šë„ë¡ "ê³ ì • ë ˆì´ì–´"ë¥¼ í•˜ë‚˜ ë‘  */
    .btn-area{
      position: relative;
      width: 100%;
      height: 90px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14px;
    }

    button{
      border:0;
      padding: 12px 18px;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      transition: transform 140ms ease, filter 140ms ease;
      min-width: 110px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      position: relative;
      z-index: 2;
    }
    #yesBtn{
      background: #4f7cff;
      color:white;
    }
    #yesBtn:hover{ filter: brightness(1.05); transform: translateY(-1px); }

    /* "ì•„ë‹ˆì˜¤"ëŠ” absoluteë¡œ ë‘ê³ , btn-area ì•ˆì—ì„œë§Œ ì›€ì§ì´ê²Œ í•¨ */
    #noBtn{
      background: rgba(255,255,255,0.10);
      color: var(--text);
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(calc(-50% + 140px), -50%);
      z-index: 3;
      will-change: left, top, transform;
    }
    #noBtn:hover{ filter: brightness(1.08); }

    .hidden{ display:none; }

    /* ====== ê²°ê³¼ í™”ë©´(ì¼€ì´í¬+í­ì£½+í…ìŠ¤íŠ¸) ====== */
    .stage{
      position: relative;
      width: 100%;
      height: 420px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction: column;
      gap: 14px;
    }

    /* ìº”ë²„ìŠ¤ í­ì£½ */
    #fx{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      z-index: 1;
      pointer-events:none;
    }

    /* ì¼€ì´í¬ ì˜ì—­ */
    .cake-wrap{
      position: relative;
      width: 320px;
      height: 250px;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      z-index: 2;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
    }

    /* ì¼€ì´í¬ ì ‘ì‹œ */
    .plate{
      position:absolute;
      bottom: 0;
      width: 320px;
      height: 18px;
      border-radius: 999px;
      background: rgba(255,255,255,0.20);
      border: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(6px);
    }

    /* ì¼€ì´í¬ ì¸µë“¤ */
    .tier{
      position:absolute;
      left: 50%;
      transform: translateX(-50%) translateY(120px);
      opacity: 0;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(4px);
      box-shadow: 0 8px 18px rgba(0,0,0,0.25);
      transition: transform 520ms cubic-bezier(.2,.9,.2,1), opacity 520ms ease;
      overflow:hidden;
    }

    /* ì¸µë³„ í¬ê¸° */
    .t1{ width: 260px; height: 54px; bottom: 18px; }
    .t2{ width: 230px; height: 50px; bottom: 72px; }
    .t3{ width: 200px; height: 46px; bottom: 122px; }
    .t4{ width: 170px; height: 42px; bottom: 168px; }
    .t5{ width: 140px; height: 38px; bottom: 210px; }

    /* í¬ë¦¼ ë¼ì¸ ëŠë‚Œ */
    .tier::before{
      content:"";
      position:absolute;
      inset: 10px 12px auto 12px;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.22);
    }
    .tier::after{
      content:"";
      position:absolute;
      left: 0;
      right: 0;
      bottom: 10px;
      margin: auto;
      width: 70%;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.16);
    }

    /* ì¸µì´ "ìŒ“ì¼ ë•Œ" í´ë˜ìŠ¤ */
    .tier.on{
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* ì´›ë¶ˆ */
    .candle{
      position:absolute;
      left: 50%;
      bottom: 250px;
      transform: translateX(-50%) translateY(40px);
      width: 16px;
      height: 40px;
      border-radius: 10px;
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.18);
      opacity: 0;
      transition: transform 500ms cubic-bezier(.2,.9,.2,1), opacity 500ms ease;
      z-index: 3;
    }
    .candle.on{ opacity:1; transform: translateX(-50%) translateY(0); }
    .flame{
      position:absolute;
      left: 50%;
      top: -14px;
      transform: translateX(-50%);
      width: 12px;
      height: 16px;
      border-radius: 999px 999px 999px 999px;
      background: rgba(255,255,255,0.28);
      filter: blur(0.2px);
      animation: flame 0.9s infinite ease-in-out;
    }
    @keyframes flame{
      0%,100%{ transform: translateX(-50%) scale(1); opacity: .9; }
      50%{ transform: translateX(-50%) scale(0.85); opacity: .6; }
    }

    /* Happy í…ìŠ¤íŠ¸ */
    .happy{
      z-index: 3;
      margin-top: 10px;
      font-size: clamp(28px, 5vw, 44px);
      font-weight: 900;
      letter-spacing: -1px;
      opacity: 0;
      transform: translateY(10px) scale(0.98);
      transition: opacity 700ms ease, transform 700ms cubic-bezier(.2,.9,.2,1);
      text-shadow: 0 10px 26px rgba(0,0,0,0.35);
    }
    .happy.on{
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    .happy span{
      display:inline-block;
      animation: pop 1.2s ease-in-out infinite;
    }
    @keyframes pop{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-3px); }
    }

    /* ì‘ì€ ë°˜ì§ì´ ë°°ê²½ */
    .sparkles{
      position:absolute;
      inset:0;
      z-index:0;
      opacity: 0.35;
      pointer-events:none;
      background:
        radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.35), transparent 60%),
        radial-gradient(2px 2px at 60% 18%, rgba(255,255,255,0.25), transparent 60%),
        radial-gradient(2px 2px at 78% 42%, rgba(255,255,255,0.30), transparent 60%),
        radial-gradient(2px 2px at 30% 70%, rgba(255,255,255,0.22), transparent 60%),
        radial-gradient(2px 2px at 85% 78%, rgba(255,255,255,0.26), transparent 60%);
    }
  </style>
</head>

<body>
  <div class="card">
    <div class="sparkles"></div>

    <!-- ì§ˆë¬¸ í™”ë©´ -->
    <div id="questionView">
      <h1>ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h1>
      <p>ì•„ë‹ˆì˜¤ë¥¼ ëˆ„ë¥´ë ¤ê³  í•˜ë©´â€¦ í™”ë©´ ì•ˆì—ì„œë§Œ ë„ë§ê°‘ë‹ˆë‹¤ ğŸ˜ˆ</p>

      <div class="btn-area" id="btnArea">
        <button id="yesBtn" type="button">ì˜ˆ</button>
        <button id="noBtn" type="button">ì•„ë‹ˆì˜¤</button>
      </div>
    </div>

    <!-- ê²°ê³¼ í™”ë©´ -->
    <div id="resultView" class="hidden">
      <div class="stage">
        <canvas id="fx"></canvas>

        <div class="cake-wrap" aria-label="cake animation">
          <div class="plate"></div>

          <div class="tier t1"></div>
          <div class="tier t2"></div>
          <div class="tier t3"></div>
          <div class="tier t4"></div>
          <div class="tier t5"></div>

          <div class="candle" id="candle">
            <div class="flame"></div>
          </div>
        </div>

        <div class="happy" id="happyText">
          <span>H</span><span>a</span><span>p</span><span>p</span><span>y</span>
          <span>&nbsp;</span>
          <span>0</span><span>0</span><span>0</span><span>!!!</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== 1) "ì•„ë‹ˆì˜¤" ë²„íŠ¼: í™”ë©´ ë°–ìœ¼ë¡œ ì ˆëŒ€ ì•ˆ ë‚˜ê°€ê²Œ + ê·¼ì²˜ ì˜¤ë©´ ìˆœê°„ì´ë™ ======
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const btnArea = document.getElementById("btnArea");

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function placeNoButtonWithinArea(preferAwayFrom){
      const areaRect = btnArea.getBoundingClientRect();
      const btnRect  = noBtn.getBoundingClientRect();

      // btnArea ì•ˆì—ì„œ ë²„íŠ¼ì´ ì™„ì „íˆ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” ë²”ìœ„
      const pad = 8;
      const minX = pad;
      const minY = pad;
      const maxX = Math.max(pad, areaRect.width  - btnRect.width  - pad);
      const maxY = Math.max(pad, areaRect.height - btnRect.height - pad);

      // ê¸°ë³¸ ëœë¤ ìœ„ì¹˜
      let x = rand(minX, maxX);
      let y = rand(minY, maxY);

      // ë§ˆìš°ìŠ¤ ì¢Œí‘œê°€ ìˆìœ¼ë©´ "ë©€ë¦¬" ê°€ë„ë¡ ëª‡ ë²ˆ ì‹œë„
      if (preferAwayFrom) {
        const tries = 8;
        let best = {x, y, score: -1};

        for (let i=0; i<tries; i++){
          const tx = rand(minX, maxX);
          const ty = rand(minY, maxY);

          const btnCenterX = areaRect.left + tx + btnRect.width/2;
          const btnCenterY = areaRect.top  + ty + btnRect.height/2;

          const dx = btnCenterX - preferAwayFrom.x;
          const dy = btnCenterY - preferAwayFrom.y;
          const score = Math.hypot(dx, dy); // ë©€ìˆ˜ë¡ ì ìˆ˜ ë†’ìŒ

          if (score > best.score) best = {x: tx, y: ty, score};
        }
        x = best.x; y = best.y;
      }

      // absolute ìœ„ì¹˜ ì ìš© (btnArea ê¸°ì¤€)
      noBtn.style.left = `${x}px`;
      noBtn.style.top  = `${y}px`;
      noBtn.style.transform = `translate(0, 0)`;
    }

    // ì´ˆê¸° ìœ„ì¹˜ ì„¸íŒ…: ë¡œë“œ í›„ ë ˆì´ì•„ì›ƒ ì¡íˆë©´ ë°°ì¹˜
    window.addEventListener("load", () => placeNoButtonWithinArea(null));
    window.addEventListener("resize", () => placeNoButtonWithinArea(null));

    function handlePointerMove(clientX, clientY){
      const btnRect = noBtn.getBoundingClientRect();
      const cx = btnRect.left + btnRect.width/2;
      const cy = btnRect.top  + btnRect.height/2;
      const dist = Math.hypot(cx - clientX, cy - clientY);

      const trigger = 120; // ê°€ê¹Œìš°ë©´ ë„ë§
      if (dist < trigger){
        placeNoButtonWithinArea({x: clientX, y: clientY});
      }
    }

    document.addEventListener("mousemove", (e) => {
      handlePointerMove(e.clientX, e.clientY);
    }, {passive:true});

    document.addEventListener("touchmove", (e) => {
      const t = e.touches[0];
      if (!t) return;
      handlePointerMove(t.clientX, t.clientY);
    }, {passive:true});

    // ====== 2) ì˜ˆ í´ë¦­: ì¼€ì´í¬ ìŒ“ê¸° -> í­ì£½ -> í…ìŠ¤íŠ¸ ======
    const questionView = document.getElementById("questionView");
    const resultView   = document.getElementById("resultView");

    const tiers = Array.from(document.querySelectorAll(".tier"));
    const candle = document.getElementById("candle");
    const happyText = document.getElementById("happyText");

    // í­ì£½ ìº”ë²„ìŠ¤
    const canvas = document.getElementById("fx");
    const ctx = canvas.getContext("2d", { alpha: true });

    function resizeCanvas(){
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener("resize", resizeCanvas);

    // ê°„ë‹¨ í­ì£½ íŒŒí‹°í´
    let particles = [];
    function spawnFirework(){
      const rect = canvas.getBoundingClientRect();
      const x = rand(rect.width * 0.2, rect.width * 0.8);
      const y = rand(rect.height * 0.12, rect.height * 0.45);

      const count = Math.floor(rand(36, 64));
      for (let i=0; i<count; i++){
        const a = rand(0, Math.PI * 2);
        const sp = rand(2.0, 5.0);
        particles.push({
          x, y,
          vx: Math.cos(a) * sp,
          vy: Math.sin(a) * sp,
          life: rand(38, 65),
          size: rand(1.5, 2.8),
          alpha: 1
        });
      }
    }

    function stepFireworks(){
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);

      // ì‚´ì§ ì”ìƒ ëŠë‚Œ
      ctx.fillStyle = "rgba(0,0,0,0.10)";
      ctx.fillRect(0, 0, rect.width, rect.height);

      const gravity = 0.06;
      particles = particles.filter(p => p.life > 0);

      for (const p of particles){
        p.vy += gravity;
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 1;
        p.alpha = Math.max(0, p.life / 65);

        // ìƒ‰ì€ ì§€ì •í•˜ì§€ ë§ë¬ë˜ ê·œì¹™ì´ â€œì°¨íŠ¸/í”Œë¡¯â€ì— ëŒ€í•œ ê±°ë¼ì„œ ì—¬ê¸°ì„  ììœ ì§€ë§Œ,
        // ê·¸ë˜ë„ ì‹¬í”Œí•˜ê²Œ í°ë¹› íŒŒí‹°í´ë¡œ ì²˜ë¦¬.
        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${0.75 * p.alpha})`;
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      }

      requestAnimationFrame(stepFireworks);
    }

    function delay(ms){ return new Promise(res => setTimeout(res, ms)); }

    async function playShow(){
      // í™”ë©´ ì „í™˜
      questionView.classList.add("hidden");
      resultView.classList.remove("hidden");

      // ìº”ë²„ìŠ¤ ë¦¬ì‚¬ì´ì¦ˆ + ë£¨í”„ ì‹œì‘
      resizeCanvas();
      particles = [];
      requestAnimationFrame(stepFireworks);

      // ì¼€ì´í¬ ìŒ“ê¸°: 1ì¸µë¶€í„° ìˆœì„œëŒ€ë¡œ
      for (let i=0; i<tiers.length; i++){
        tiers[i].classList.add("on");
        await delay(420);
      }

      // ì´›ë¶ˆ
      candle.classList.add("on");
      await delay(350);

      // í­ì£½: ì—¬ëŸ¬ ë²ˆ í„°ëœ¨ë¦¬ê¸°
      for (let i=0; i<8; i++){
        spawnFirework();
        await delay(220);
      }

      // í…ìŠ¤íŠ¸ ë“±ì¥
      happyText.classList.add("on");
    }

    yesBtn.addEventListener("click", playShow);
  </script>
</body>
</html>
